ssh 批量上传文件
上传文件大多数用的是ftp，但是用ftp有一点不好，就是本地和远程的目录要对应，这样就要在多个目录下去切换，这样挺麻烦的，如果不注意的话，很有可能传错。所以想了个办法利用scp来批量上传文件或者目录。

 

一，scp上传不要输入密码

如果要用scp来上传文件，第一步就要去掉scp上传时要输入密码。要不然就没办法批量上传了。具体请参考：ssh 不用输入密码

 

二，ssh批量上传脚本

 

1,要上传的文件列表放到一个test文件中

C代码  收藏代码
root@ubuntu:/home/zhangy# cat test    
/home/zhangy/test/aaa    
/home/zhangy/test/nginx.conf    
    
/home/zhangy/test/test.sql    
/home/zhangy/test/pa.txt    
/home/zhangy/test/password    
 

上面就要上传的文件。

 

2,批量上传的脚本

 

vim file_upload.sh

C代码  收藏代码
#!/bin/sh  
  
DATE=`date +%Y_%m_%d_%H`  
  
if [ $1 ]  
then  
  for file in $(sed '/^$/d' $1)     //去掉空行  
  do  
    if [ -f $file ]                 //普通文件  
    then  
      res=`scp $file $2:$file`      //上传文件  
      if [ -z $res ]                //上传成功  
      then  
        echo $file >> ${DATE}_upload.log   //上传成功的日志  
      fi  
    elif [ -d $file ]              //目录  
    then  
      res=`scp -r $file $2:$file`  
      if [ -z $res ]  
      then  
        echo $file >> ${DATE}_upload.log  
      fi  
    fi  
  done  
else  
  echo "no file" >> ${DATE}_error.log  
fi  
 
上传成功后，返回的是一个空行，上传不成功，什么都不返回

 

3，上传的格式

C代码  收藏代码
./file_upload.sh test 192.168.1.13    
test是上传列表文件，192.168.1.13文件要传到的地方。

0


转载请注明
作者:海底苍鹰
地址:http://blog.51yip.com/linux/1356.html
 

1. 转换文件大小写：

A script to convert the specified filenames to lower case.

 

C代码  收藏代码
#!/bin/sh  
 # lowerit  
# convert all file names in the current directory to lower case  
# only operates on plain files--does not change the name of directories  
# will ask for verification before overwriting an existing file  
for x in `ls`  
do  
    if [ ! -f $x ]; then  
        continue  
    fi  
    lc=`echo $x  | tr '[A-Z]' '[a-z]'`  
    if [ $lc != $x ]; then  
        mv -i $x $lc  
    fi  
done  
 
 

or

 

C代码  收藏代码
if test $# = 0  
then  
    echo "Usage $0: <files>" 1>&2  
    exit 1  
fi  
  
for filename in "$@"  
do  
    new_filename=`echo "$filename" | tr A-Z a-z`  
    test "$filename" = "$new_filename" && continue  
    if test -r "$new_filename"  
    then  
        echo "$0: $new_filename exists" 1>&2  
    elif test -e "$filename"  
    then  
        mv "$filename" "$new_filename"  
    else  
        echo "$0: $filename not found" 1>&2  
    fi  
done  
 
 

2. 看网站 Watch a Website

 

A script to repeated download a webpage until it matches a regex then notify an e-mail address.

For example to get e-mail when Kesha tickets (not for yourself of course) go on sale you might run:

 

C代码  收藏代码
% watch_website.sh http://ticketek.com.au/ 'Ke[sS$]+ha' andrewt@cse.unsw.edu.au  
  
  
repeat_seconds=300  #check every 5 minutes  
  
if test $# = 3  
then  
    url=$1  
    regexp=$2  
    email_address=$3  
else  
    echo "Usage: $0 <url> <regex>" 1>&2  
    exit 1  
fi  
  
while true  
do  
    if wget -O- -q "$url"|egrep "$regexp" >/dev/null  
    then  
        echo "Generated by $0" | mail -s "$url now matches $regexp" $email_address  
        exit 0  
    fi  
    sleep $repeat_seconds  
done  
 
